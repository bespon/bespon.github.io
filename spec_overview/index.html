<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Spec overview - BespON: Bespoken Object Notation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Spec overview";
    var mkdocs_page_input_path = "spec_overview.md";
    var mkdocs_page_url = "/spec_overview/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> BespON: Bespoken Object Notation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Spec overview</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#bespon-specification-overview">BespON Specification Overview</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#file-format">File format</a></li>
        
            <li><a class="toctree-l3" href="#none-type">None type</a></li>
        
            <li><a class="toctree-l3" href="#bool">Bool</a></li>
        
            <li><a class="toctree-l3" href="#numbers">Numbers</a></li>
        
            <li><a class="toctree-l3" href="#unicode-strings">Unicode strings</a></li>
        
            <li><a class="toctree-l3" href="#lists">Lists</a></li>
        
            <li><a class="toctree-l3" href="#dicts">Dicts</a></li>
        
            <li><a class="toctree-l3" href="#key-paths">Key paths</a></li>
        
            <li><a class="toctree-l3" href="#sections">Sections</a></li>
        
            <li><a class="toctree-l3" href="#tags">Tags</a></li>
        
            <li><a class="toctree-l3" href="#right-to-left-code-points">Right-to-left code points</a></li>
        
            <li><a class="toctree-l3" href="#comments">Comments</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">BespON: Bespoken Object Notation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Spec overview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="bespon-specification-overview">BespON Specification Overview</h1>
<p>This is an overview of the BespON specification.  A more formal,
more detailed specification will follow as soon as the Python implementation
is refined further.  More details are available in the Python implementation,
particularly in <code>grammar.py</code> and <code>re_patterns.py</code>.</p>
<h2 id="file-format">File format</h2>
<p>The default encoding for BespON files is UTF-8.  The default extension
is <code>.bespon</code>.</p>
<p>As a text-based format, BespON is specified at the level of Unicode code
points.  Some code points are always invalid as literals within BespON data,
and may only be transmitted in backslash-escaped form within strings.</p>
<ul>
<li>All code points with Unicode <code>General_Category</code> Cc (control characters)
    are prohibited as literals, with the exception of the horizontal tab
    U+0009 (<code>\t</code>) and line feed U+000A (<code>\n</code>).  The carriage return
    U+000D (<code>\r</code>) is also allowed as a literal if followed immediately by a
    line feed, in which case the <code>\r\n</code> sequence is normalized to <code>\n</code>.
    Otherwise, literal <code>\r</code> is prohibited.</li>
<li>The line separator and paragraph separator U+2028 and U+2029 are
    prohibited as literals.</li>
<li>All code points with Unicode property <code>Bidi_Control</code> are prohibited as
    literals.  Since these code points can easily cause the appearance of
    text to differ from the actual order in which code points are entered in
    a file, they are not appropriate in a text-based data format meant for
    human editing.</li>
<li>The use of a BOM (U+FEFF) is discouraged, since the default encoding
    is UTF-8.  A single BOM at the start of a file or stream is allowed,
    and discarded.  A BOM at any other location is prohibited.</li>
<li>All code points with Unicode property <code>Noncharacter_Code_Point</code> are
    prohibited as literals.</li>
<li>All Unicode surrogate code points (U+D800 – U+DFFFF) are prohibited as
    literals, except when properly paired in an implementation in a language
    whose string representation requires them (UTF-16, UCS-2, etc.).</li>
</ul>
<h2 id="none-type">None type</h2>
<p>None/null/undefined is represented as <code>none</code>.  All other capitalizations of
<code>none</code> are invalid and must produce errors.  Unlike YAML, uppercase and
titlecase variants of reserved words are NOT equivalent to their lowercase
versions, and other capitalization variants are NOT valid unquoted strings.
The literal string <code>none</code>, in any capitalization, can only be represented by
using a quoted string.</p>
<h2 id="bool">Bool</h2>
<p>Boolean values are represented as <code>true</code> and <code>false</code>.  As with <code>none</code>, all
other capitalizations are invalid and must produce errors.  The only way
to obtain the literal strings <code>true</code> and <code>false</code>, in any capitalization, is
to use quoted strings.  Unlike TOML, boolean literals have a constant type
in all contexts; they are not strings when used as dict keys, but booleans
when used as dict values.</p>
<h2 id="numbers">Numbers</h2>
<h3 id="integers">Integers</h3>
<p>Decimal, hexadecimal, octal, and binary integers are supported.  Base
prefixes for non-decimal numbers are <code>0x</code>, <code>0o</code>, and <code>0b</code>; other
capitalizations are prohibited.  A single underscore is allowed after a
base prefix before the first digit, and single underscores are allowed
between digits (for example, <code>0x_12_34</code>).  Hexadecimal values may use either
uppercase <code>A-F</code> or lowercase <code>a-f</code>, but mixing cases is prohibited.</p>
<p>Signs <code>+</code> and <code>-</code> may be separated from the first digit character by spaces
or tabs, but this is discouraged.  Breaking a line between a sign and the
number to which it belongs is prohibited.</p>
<p>Implementations in languages that lack an integer type must interpret
integers as floats.</p>
<p>Implementations are expected to use 32-bit unsigned integers at minimum.
Any integer value that cannot fit in an implementation's integer type must
result in an error, rather than an integer overflow or undefined behavior.</p>
<h3 id="floats">Floats</h3>
<p>Decimal and hexadecimal floats are supported.  Decimal floats use <code>e</code> or <code>E</code>
for the exponent, while <code>p</code> or <code>P</code> are used for hex.  Single underscores
are allowed after the base prefix, between digits, and before exponents
(for example, <code>0x_12_34_p5_6</code>).</p>
<p>Signs <code>+</code> and <code>-</code> may be separated from the first digit character by spaces
or tabs, but this is discouraged.  Breaking a line between a sign and the
number to which it belongs is prohibited.</p>
<p>Implementations are expected to use float types compatible with IEEE 754
binary64.</p>
<p>Infinity is represented as <code>inf</code>, and not a number as <code>nan</code>.  All other
capitalizations are invalid, and the literal strings <code>inf</code> and <code>nan</code> require
quoted strings.</p>
<h2 id="unicode-strings">Unicode strings</h2>
<p>Unicode normalization is not performed on the Unicode string type, to avoid
potential information loss issues.  Unicode normalization before saving data
in BespON format, or after loading data, is encouraged as appropriate.</p>
<h3 id="unquoted-strings">Unquoted strings</h3>
<p>Unquoted strings that fit the pattern for an ASCII identifier and are not
a variant of <code>none</code>/<code>true</code>/<code>false</code>/<code>inf</code>/<code>nan</code> may be used anywhere,
including as dict keys.  These must match the regular expression
<code>_*[A-Za-z][0-9A-Z_a-z]*</code>.</p>
<p>Implementations should provide an option to enable unquoted strings based on
Unicode identifiers, using Unicode properties <code>XID_Start</code> and <code>XID_Continue</code>
with the omission of the Hangul filler code points U+115F, U+1160, U+3164,
and U+FFA0 (which typically are rendered as whitespace).  This is not the
default because of the confusability and security implications of using
unquoted non-ASCII code points.</p>
<p>Implementations should also provide an option to disable unquoted strings.
This can be useful when it is desirable to avoid any potential for ambiguity.</p>
<h3 id="quoted-inline-strings">Quoted inline strings</h3>
<p>Quoted inline strings are delimited with one or more single quotation marks
<code>'</code>, double quotation marks <code>"</code>, or backticks <code>`</code>.</p>
<p>Backslash escapes are enabled within strings delimited by single and double
quotation marks.  Escapes of the forms <code>\xHH</code>, <code>\uHHHH</code>, <code>\U00HHHHHH</code>, and
<code>\u{H...H}</code> are all allowed, with the restriction that all non-numeric hex
characters must have the same case (uppercase or lowercase) within a given
escape.</p>
<p>Strings delimited by single and double quotation marks follow the same rules.
A string that starts with one quotation mark <code>'</code> or <code>"</code> ends at the next
identical quotation mark that is not backslash-escaped.  The sequences <code>''</code>
and <code>""</code> represent the empty string.  Longer delimiter sequences such as
<code>'''</code> and <code>"""</code> may be used to include any unescaped delimiter sequence that
is shorter or longer than the delimiters.  Such sequences must be multiples
of 3 characters in length and no longer than 90 characters.</p>
<p>Strings delimited by backticks begin with a delimiter sequence of length
1, 2, 3, or a multiple of 3 no longer than 90 characters, and end when the
same delimiter sequence is next encountered.  This is similar to Markdown.
These are literal strings; there are no backslash escapes.  If the first
non-space character at the beginning or end of a literal string is a
backtick, then one space at that end of the string is stripped.  This allows,
for example, the sequence <code>`` ` ``</code> to represent the single
backtick <code>`</code>.</p>
<p>Inline quoted strings may be wrapped over multiple lines.  When this is done,
the indentation of the first continuation line must be equal to or greater
than that of the line on which it begins, and any subsequent continuation
lines must have that same indentation.  Wrapped quoted strings are unwrapped
by replacing each line break with a space if the last character before the
break does not have the Unicode property <code>White_Space</code>, and simply stripping
breaks otherwise.</p>
<h3 id="quoted-block-strings">Quoted block strings</h3>
<p>Quoted block strings preserve literal line breaks and indentation relative to
the closing delimiter.  They start with a pipe <code>|</code> followed by a sequence of
single or double quotation marks or backticks.  The rest of the line after
this opening sequence must contain nothing but whitespace (space, tab, line
feed).  The sequence must be a multiple of 3 characters in length and no
longer than 90 characters.  The string ends when the same sequence of
quotation marks/backticks is found between a pipe <code>|</code> and a slash <code>/</code>.  The
sequence must not appear unescaped anywhere else within the string.  Shorter
or longer sequences of quotation marks/backticks are allowed unescaped.</p>
<p>For example,</p>
<pre><code class="text">|```
First line
    second line
|```/
</code></pre>

<p>would be equivalent to <code>"First line\n    second line\n"</code>.  Note that literal
line breaks and indentation relative to the closing delimiter are preserved.
When a block string starts at the beginning of a line, the opening and
closing delimiters must have the same indentation.  Otherwise, the closing
delimiter must have indentation greater than or equal to that of the line
on which the block string begins.</p>
<p>The choice of <code>'</code> and <code>"</code> versus <code>`</code> in the delimiters determines whether
backslash escapes are enabled.  When they are, a backslash followed
immediately by zero or more spaces and a literal newline becomes the empty
string.  Thus,</p>
<pre><code class="text">|&quot;&quot;&quot;
First line\
Second line
|&quot;&quot;&quot;/
</code></pre>

<p>would be equivalent to <code>"First lineSecond line"</code>.</p>
<h2 id="lists">Lists</h2>
<p>Lists are ordered collections of objects.  Objects are not all required to be
of the same type.</p>
<p>By default, an implementation must raise an error if the total nesting depth
of all collection objects (lists and dicts) exceeds 100.</p>
<p>There are two list syntaxes.  In indentation-based syntax, list elements are
denoted with asterisks <code>*</code>.  For example,</p>
<pre><code class="text">* 'First element'
* 'Second element'
</code></pre>

<p>Indentation between the asterisk and the beginning of the following object
is strongly encouraged, but not required.  Indentation may be spaces or tabs.
If the indentation character immediately before and after the <code>*</code> is a tab,
then the <code>*</code> is ignored in calculating the total indentation; otherwise it
is treated as equivalent to a space.  In indentation-based syntax, all <code>*</code>
in a list must have the same indentation, and all objects that follow them
must also have the same indentation.</p>
<p>There is also a more compact, inline syntax for lists, in which the list is
delimited by square brackets <code>[...]</code> and individual list elements are
separated by commas.  For example,</p>
<pre><code class="text">['First element', 'Second element']
</code></pre>

<p>Everything within an inline list must have indentation greater than or equal
to that of the line on which the list started.  While logical and consistent
indentation beyond this is encouraged, it is not enforced in any way.</p>
<h2 id="dicts">Dicts</h2>
<p>Dicts are mappings of keys to values.</p>
<p>By default, an implementation must raise an error if the total nesting depth
of all collection objects (lists and dicts) exceeds 100.</p>
<p>Only <code>none</code>, <code>true</code>, <code>false</code>, integers, strings, byte strings, and derived
types are allowed as keys.  Floating point numbers and collection types are
specifically excluded.  Floating point numbers are problematic as keys due to
rounding, and because <code>nan</code> is not equal to itself.  Collection types can be
problematic as keys depending on how mutability is handled, and are not
supported as keys in some programming languages.</p>
<p>Duplicate keys are strictly prohibited.</p>
<p>As with lists, there are two syntaxes for dicts.  In indentation-based syntax,
all keys must have the same indentation, and values must have indentation
consistent with their keys.  Keys and values are separated by equals signs
<code>=</code>.  For example,</p>
<pre><code class="text">key = value
another_key = 'another value that
    continues'
yet_another_key =
    sub_dict_key = sub_dict_value
</code></pre>

<p>Quoted values that start immediately after their keys (on the same line) may
have the same indentation as their keys, following the rules for continuation
lines for quoted strings.  This is convenient when it is desirable to avoid
indentation.  However, indenting values is encouraged.</p>
<p>There is also a more compact, inline syntax for dicts that parallels that for
inline lists.  A dict is delimited by curly braces <code>{...}</code> and individual
key-value pairs are separated by commas.  For example,</p>
<pre><code class="text">{key = value, another_key = another_value}
</code></pre>

<p>As with inline lists, everything within an inline dict must have indentation
greater than or equal to that of the line on which the dict started.  While
logical and consistent indentation beyond this is encouraged, it is not
enforced in any way.</p>
<h2 id="key-paths">Key paths</h2>
<p>Key paths provide a compact syntax for expressing nested dicts (and to a
lesser extent lists).  A key path is a sequence of period-separated,
unquoted strings that are suitable as dict keys.  For example,</p>
<pre><code class="text">key.subkey.subsubkey = 123
</code></pre>

<p>would be equivalent to</p>
<pre><code class="text">key = {subkey = {subsubkey = 123}}
</code></pre>

<p>A key path can only pass through dict nodes that do not yet exist, or that
do exist but have only ever been visited previously as part of a key path.
The final element of a key path must not have been defined previously,
because that would violate the prohibition on duplicate keys.  Thus,</p>
<pre><code class="text">key.subkey.subsubkey = 123
key.subkey.another_subsubkey = 456
</code></pre>

<p>would be valid and equivalent to</p>
<pre><code class="text">key = {subkey = {subsubkey = 123, another_subsubkey = 456}}
</code></pre>

<p>However,</p>
<pre><code class="text">key.subkey = {}
key.subkey.another_subsubkey = 456
</code></pre>

<p>would be invalid, because it is attempting to define <code>key.subkey</code> both as
an empty dict and also as a dict <code>{another_subsubkey = 456}</code>.</p>
<p>The final element of a key path may alternatively be an asterisk <code>*</code>, in
which case it adds a list element.  Thus,</p>
<pre><code class="text">key.subkey.* = 123
key.subkey.* = 456
</code></pre>

<p>would be equivalent to</p>
<pre><code class="text">key = {subkey = [123, 456]}
</code></pre>

<p>Key paths are scoped.  All key path nodes created from within a given dict
are accessible from within that dict.  However, all of those nodes become
inaccessible once the dict is closed.  Thus, in</p>
<pre><code class="text">key =
    subkey.subsubkey = 123
</code></pre>

<p>it would be possible to add <code>subkey.another_subsubkey</code> at the <code>subkey</code> level,
because key paths based on <code>subkey</code> are still within scope.  However, it
would not be possible to use <code>key.subkey.another_subkey</code> at the <code>key</code> level,
since that is outside the scope.</p>
<h2 id="sections">Sections</h2>
<p>Sections provide a way to use indentation-based syntax without using
deep indentation.  A section is started by a pipe <code>|</code> followed by a sequence
of equals signs whose length is a multiple of 3 and is no longer than 90
characters.  This is followed by a key path or a key, which must terminate
on the line where the key path begins (line breaks are not permitted).
Everything after the section start is included under the specified key path
or key.  For example,</p>
<pre><code class="text">|=== section.subsection
key = value
another_key = another_value
</code></pre>

<p>would be equivalent to</p>
<pre><code class="text">section = {subsection = {key = value, another_key = another_value}}
</code></pre>

<p>Sections may also use the asterisk <code>*</code> as a key, to assemble a list while
avoiding the associated indentation in normal syntax.  For example,</p>
<pre><code class="text">|=== *
key = value

|=== *
another_key = another_value
</code></pre>

<p>is equivalent to</p>
<pre><code class="text">[{key = value}, {another_key = another_value}]
</code></pre>

<p>A section ends at the next section.  Alternatively, it is possible to return
to the top (root) level of the data structure by using the section closing
element, which has the form <code>|===/</code>.  This parallels the delimiters for block
strings.  However, when this is used to close a section, the number of equals
signs <code>=</code> in the closing element must match the number used to open the
section.  Furthermore, if the closing element is ever used, then ALL sections
must be closed explicitly.</p>
<h2 id="tags">Tags</h2>
<p>All types discussed thus far are implicitly typed.  BespON also provides for
explicitly typed objects, with the tagging syntax <code>(tag)&gt;</code>.  Support for
tags and associated binary types will be added to the Python implementation
soon.</p>
<p>Tag syntax makes possible byte strings.</p>
<pre><code class="text">(bytes)&gt; 'Some text'
</code></pre>

<p>It also makes possible arbitrary binary data.</p>
<pre><code class="text">* (base16)&gt; '536F6D652074657874'
* (base64)&gt; 'U29tZSB0ZXh0'
</code></pre>

<p>Tag syntax will eventually provide support for additional types, and provide
an optional extension mechanism for user-defined types.</p>
<h2 id="right-to-left-code-points">Right-to-left code points</h2>
<p>BespON is intended for human editing.  This can be difficult with
code points from right-to-left languages (code points with Unicode
<code>Bidi_Class</code> R or AL), because it is possible for a key and a value to be
reversed in visual representation due to the bidirectional text rendering
algorithms.  For example, suppose we have the data</p>
<pre><code class="text">א =
  1
ב =
  2
</code></pre>

<p>In this form, the meaning is clear, as a mapping of Hebrew letters to
integers.  However, put these values on a single line, and the order of keys
and values is lost at the visual level (though still retained in terms of
logical code point ordering).</p>
<pre><code class="text">{א = 1, ב = 2}
</code></pre>

<p>This is the same as</p>
<pre><code class="text">{\u05D0 = 1, \u05D1 = 2}
</code></pre>

<p>Under ideal circumstances, a rendering engine would identify that this is a
data as opposed to text context, and provide a useful rendering.  Given that
this will rarely be possible, the next best thing would be to require that
right-to-left code points only appear in contexts in which this sort of
key-value reversal in visual rendering is not possible.</p>
<p>By default, whenever a string contains code points with Unicode
<code>Bidi_Class</code> R or AL on its last line, no string or number is allowed to
follow it on that line.  Any following object must be on a subsequent line,
to avoid the potential of confusion due to bidirectional rendering.  Such
a string may still be followed by a comma <code>,</code>, bracket <code>]</code>, brace <code>}</code>,
equals sign <code>=</code>, or other non-string, non-digit element, since this will not
introduce the possibility of ambiguous rendering.</p>
<h2 id="comments">Comments</h2>
<p>Comments come in two forms.</p>
<p>Line comments start with a single number sign <code>#</code> that is not followed
immediately by another <code>#</code>, and go to the end of the line.  Line comments may
optionally be preserved in round tripping that only modifies data, as opposed
to adding or deleting values.  However, line comments cannot in general
survive round tripping, because they may appear anywhere, with any
indentation, in any quantity.  So far as syntax is concerned, they are not
uniquely associated with any particular data element.</p>
<p>Doc comments are uniquely associated with individual data objects.  Each data
object may have at most one doc comment.  The doc comment must come before
the object, and may only be separated from it by a tag (doc comments come
before tags).  Doc comments come in two forms.  Inline doc comments start
with three number signs <code>###</code>, or a sequence that has a length that is a
multiple of 3 and is no longer than 90.  They follow the same rules as inline
quoted strings, with two additional restriction in indentation-based
syntax:</p>
<ul>
<li>A doc comment must have the same indentation as its object.</li>
<li>If a doc comment starts at the beginning of a line, it cannot be followed
    on its last line by anything (other than a line comment).</li>
</ul>
<p>Doc comments also come in a block form, that follows the same rules as block
strings:</p>
<pre><code class="text">|###
Block doc comments.

These can contain empty lines.
|###/
</code></pre>

<p>The rules about indentation-based syntax apply to these as well.</p>
<p>Because doc comments are uniquely associated with individual data objects,
they may survive round tripping even when data is added or removed.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
